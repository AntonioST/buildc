<?xml version="1.0" encoding="UTF-8"?>
<project>
    <!--initial-->
    <property environment="env"/>
    <fail unless="env.SCALA_HOME">env 'SCALA_HOME' not set</fail>
    <property name="scala.home" value="${env.SCALA_HOME}"/>
    <exec executable="${scala.home}/bin/scala"
          outputproperty="scala.version.description"
          failonerror="true">
        <arg value="-version"/>
    </exec>
    <script language="javascript"><![CDATA[
        var description = self.getProject().getProperty('scala.version.description');
        var version = 'version';
        var ii = description.indexOf(version);
        var ij = description.indexOf(' ', ii + version.length() + 2);
        description = description.substring(ii + 1, ij).trim();
        self.getProject().setProperty('scala.version', description);
    ]]></script>
    <echo message="[scala] home=${scala.home}" level="verbose"/>
    <echo message="[scala] version=${scala.version}" level="verbose"/>
    <!--task define-->
    <taskdef uri="antlib:scala.tools.ant"
             resource="scala/tools/ant/antlib.xml"
             onerror="failall">
        <classpath path="${scala.home}/lib/scala-compiler.jar"/>
        <classpath path="${scala.home}/lib/scala-library.jar"/>
        <classpath path="${scala.home}/lib/scala-reflect.jar"/>
    </taskdef>
</project>