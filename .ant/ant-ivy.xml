<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant">
    <!--
    pre defined property
    -->
    <property name="release.dir" value="release"/>
    <!--
    custom section
    -->
    <extension-point name="-pre-publish"/>
    <!--
    initial section
    -->
    <target name="-ivy-init">
        <property name="lib.dir" value="lib"/>
        <available property="exist.ivy" file="ivy.xml" type="file"/>
        <available property="exist.lib" file="${lib.dir}" type="dir"/>
    </target>
    <!--
    retrieve section
    -->
    <target name="-try-retrieve" depends="-ivy-init" if="exist.ivy" unless="exist.lib" extensionOf="-post-init">
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact].[ext]"/>
    </target>
    <target name="retrieve" depends="-ivy-init" if="exist.ivy">
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact].[ext]"/>
    </target>
    <!--
    publish section
    -->
    <target name="publish" depends="-ivy-init,-pre-publish"  if="exist.ivy">
        <fail unless="project.name">project.name set set</fail>
        <fail unless="project.version">project.version set set</fail>
        <ivy:resolve/>
        <ivy:publish resolver="local"
                     pubrevision="${project.version}"
                     status="release"
                     overwrite="true"
                     update="true"
                     forcedeliver="true">
            <ivy:artifacts pattern="${release.dir}/[artifact].[ext]"/>
            <ivy:artifacts pattern="${release.dir}/[artifact]-[type].[ext]"/>
        </ivy:publish>
        <echo message="project ${project.name} released with version ${project.version}"/>
    </target>
</project>